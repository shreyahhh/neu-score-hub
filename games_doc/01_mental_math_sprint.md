# Mental Math Sprint - Complete Documentation

## Game Overview
**Game Type:** `mental_math_sprint`  
**Component:** `src/pages/games/MentalMathEasy.tsx`  
**Route:** `/games/mental-math-easy`  
**Status:** ✅ Fully Implemented

## Game Configuration

### Questions/Problems
- **Source:** Hardcoded in component (`PROBLEMS` array)
- **Location:** `src/pages/games/MentalMathEasy.tsx` (lines 12-23)
- **Count:** 10 problems
- **Format:** Each problem has:
  - `id`: Unique identifier
  - `startValue`: Starting number (100-109 range)
  - `operand`: Number to add/subtract (6-19 range)
  - `operator`: '+' or '-'
  - `correctAnswer`: Pre-calculated answer

### Timer Configuration
- **Time Per Question:** 7 seconds
- **Timer Resets:** Yes, for each question (using `key={currentProblem}`)
- **Total Game Time:** ~70 seconds (10 questions × 7 seconds)

### Game Flow
1. **Instructions Screen** → Shows game rules
2. **Start Button** → User clicks to begin
3. **Playing State** → 10 math problems, 7 seconds each
4. **Results Screen** → Shows score breakdown

## Data Submission

### API Endpoint
- **Function:** `submitGame('mental_math_sprint', raw_data)`
- **Location:** `src/lib/api.ts` → `submitGame()`
- **Endpoint:** `POST /api/games/submit`
- **Backend Game Type:** `mental_math_sprint`

### Submission Format
```javascript
{
  game_type: "mental_math_sprint",
  user_id: "uuid",  // From DEFAULT_USER_ID or user context
  raw_data: [
    {
      problem: "103 - 9",           // String format: "startValue operator operand"
      user_answer: 94,              // User's numeric answer
      correct_answer: 94,            // Correct numeric answer
      is_correct: true,              // Boolean
      time_taken: 2.1               // Seconds (0 to 7)
    },
    // ... 9 more problems
  ]
}
```

### Data Collection
- **Time Tracking:** Records `time_taken` for each question from `questionStartTime`
- **Answer Validation:** Compares `userNum === problem.correctAnswer`
- **Timeout Handling:** If timer expires, records `time_taken: 7` and `is_correct: false`

## Scoring System

### Score Retrieval
- **Primary Source:** Backend API response
- **Response Format:**
  ```javascript
  {
    session_id: "uuid",
    version_used: "V1",
    scores: {
      final_score: 85.5,
      competencies: {
        accuracy: { raw: 90, weight: 0.40, weighted: 36 },
        speed: { raw: 80, weight: 0.30, weighted: 24 },
        quantitative_aptitude: { raw: 85, weight: 0.20, weighted: 17 },
        mental_stamina: { raw: 70, weight: 0.10, weighted: 7 }
      },
      raw_stats: { ... }
    }
  }
  ```

### Fallbacks
- **No Frontend Scoring:** This game relies entirely on backend scoring
- **Error Handling:** If backend fails, shows alert: "Failed to submit game. Please try again."
- **No Local Storage:** No fallback scores stored locally

### Competencies Tested
1. **Accuracy** (40% weight)
   - **Calculation:** Backend calculates based on `is_correct` for each problem
   - **Formula:** `(correct_answers / total_questions) * 100`
   - **Backend Logic:** Binary mode (100 or 0) or graded based on error percentage

2. **Speed** (30% weight)
   - **Calculation:** Backend calculates based on `time_taken` for each problem
   - **Formula:** `(time_limit - avg_time) / time_limit * 100`
   - **Backend Logic:** Rewards faster completion

3. **Quantitative Aptitude** (20% weight)
   - **Calculation:** Backend combines accuracy and speed
   - **Formula:** `(accuracy * 0.7) + (speed * 0.3)`
   - **Backend Logic:** Measures mathematical reasoning ability

4. **Mental Stamina** (10% weight)
   - **Calculation:** Backend analyzes speed consistency
   - **Formula:** Based on speed standard deviation
   - **Backend Logic:** Lower std dev = higher score (consistency matters)

### Final Score Calculation
```
Final Score = (
  Accuracy × 0.40 +
  Speed × 0.30 +
  Quantitative Aptitude × 0.20 +
  Mental Stamina × 0.10
)
```

## Backend Integration

### Expected Backend Behavior
1. **Receives:** Array of problem responses with timing data
2. **Calculates:** All 4 competencies using configured formulae
3. **Returns:** Complete score breakdown with `session_id` and `version_used`

### Backend Configuration
- **Scoring Version:** Retrieved from backend (stored in `version_used`)
- **Active Config:** Backend uses active scoring configuration for this game type
- **Config Endpoint:** `GET /api/scoring/active/mental_math_sprint`

### Data Storage
- **Session ID:** Generated by backend
- **User ID:** From `DEFAULT_USER_ID` constant or user context
- **Timestamp:** Backend records submission time

## Frontend Display

### Score Display Component
- **Component:** `src/components/ScoreDisplay.tsx`
- **Transformation:** Uses `transformGameResult()` from `src/lib/transformers.ts`
- **Display Format:**
  - Final score (large number)
  - Competency breakdown (bars and percentages)
  - Weighted contributions table
  - Scoring version indicator

### Result Format
```typescript
interface GameResult {
  gameId: string;              // session_id from backend
  gameName: string;            // "Mental Math Sprint"
  timestamp: Date;
  finalScore: number;          // 0-100
  competencies: CompetencyScore[];
  rawData: {
    session_id: string;
    version_used: string;
    scores: { ... };
  };
}
```

## Key Files Reference

### Frontend Files
- **Game Component:** `src/pages/games/MentalMathEasy.tsx`
- **API Client:** `src/lib/api.ts` (submitGame function)
- **Score Display:** `src/components/ScoreDisplay.tsx`
- **Transformers:** `src/lib/transformers.ts`
- **Types:** `src/lib/types.ts`

### Backend Endpoints
- **Submit:** `POST /api/games/submit`
- **Get Config:** `GET /api/scoring/active/mental_math_sprint`
- **Get History:** `GET /api/games/results/mental_math_sprint`
- **Get Versions:** `GET /api/scoring/versions/mental_math_sprint`

## Notes for Backend Development

1. **No Questions in Database:** Questions are hardcoded in frontend
2. **Time Tracking:** Frontend sends precise `time_taken` in seconds (0-7 range)
3. **Answer Format:** Both `user_answer` and `correct_answer` are numbers
4. **Problem String:** Frontend sends `problem` as string for reference only
5. **Scoring Dependency:** Frontend has no fallback scoring - must rely on backend
6. **Session Creation:** Backend creates session on submission
7. **Version Tracking:** Backend should return `version_used` for transparency

## Testing Considerations

- **Timeout Scenarios:** Test when user doesn't answer in time
- **Incorrect Answers:** Test scoring with various error rates
- **Speed Variations:** Test with different average response times
- **Backend Failures:** Test error handling when API fails
- **Score Validation:** Verify all 4 competencies are calculated correctly

